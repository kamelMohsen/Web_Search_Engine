<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (1.8.0_66-ea) on Mon Jun 13 09:43:10 CEST 2016 -->
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>org.apache.lucene.search.grouping (Lucene 6.1.0 API)</title>
<meta name="date" content="2016-06-13">
<link rel="stylesheet" type="text/css" href="../../../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="org.apache.lucene.search.grouping (Lucene 6.1.0 API)";
        }
    }
    catch(err) {
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../overview-summary.html">Overview</a></li>
<li class="navBarCell1Rev">Package</li>
<li>Class</li>
<li><a href="package-use.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li>Prev&nbsp;Package</li>
<li><a href="../../../../../org/apache/lucene/search/grouping/function/package-summary.html">Next&nbsp;Package</a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../index.html?org/apache/lucene/search/grouping/package-summary.html" target="_top">Frames</a></li>
<li><a href="package-summary.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<div class="header">
<h1 title="Package" class="title">Package&nbsp;org.apache.lucene.search.grouping</h1>
<div class="docSummary">
<div class="block">Grouping.</div>
</div>
<p>See:&nbsp;<a href="#package.description">Description</a></p>
</div>
<div class="contentContainer">
<ul class="blockList">
<li class="blockList">
<table class="typeSummary" border="0" cellpadding="3" cellspacing="0" summary="Class Summary table, listing classes, and an explanation">
<caption><span>Class Summary</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Class</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tbody>
<tr class="altColor">
<td class="colFirst"><a href="../../../../../org/apache/lucene/search/grouping/AbstractAllGroupHeadsCollector.html" title="class in org.apache.lucene.search.grouping">AbstractAllGroupHeadsCollector</a>&lt;GH extends <a href="../../../../../org/apache/lucene/search/grouping/AbstractAllGroupHeadsCollector.GroupHead.html" title="class in org.apache.lucene.search.grouping">AbstractAllGroupHeadsCollector.GroupHead</a>&gt;</td>
<td class="colLast">
<div class="block">This collector specializes in collecting the most relevant document (group head) for each group that match the query.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../../../org/apache/lucene/search/grouping/AbstractAllGroupHeadsCollector.GroupHead.html" title="class in org.apache.lucene.search.grouping">AbstractAllGroupHeadsCollector.GroupHead</a>&lt;GROUP_VALUE_TYPE&gt;</td>
<td class="colLast">
<div class="block">Represents a group head.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../../../org/apache/lucene/search/grouping/AbstractAllGroupsCollector.html" title="class in org.apache.lucene.search.grouping">AbstractAllGroupsCollector</a>&lt;GROUP_VALUE_TYPE&gt;</td>
<td class="colLast">
<div class="block">A collector that collects all groups that match the
 query.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../../../org/apache/lucene/search/grouping/AbstractDistinctValuesCollector.html" title="class in org.apache.lucene.search.grouping">AbstractDistinctValuesCollector</a>&lt;GC extends <a href="../../../../../org/apache/lucene/search/grouping/AbstractDistinctValuesCollector.GroupCount.html" title="class in org.apache.lucene.search.grouping">AbstractDistinctValuesCollector.GroupCount</a>&lt;?&gt;&gt;</td>
<td class="colLast">
<div class="block">A second pass grouping collector that keeps track of distinct values for a specified field for the top N group.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../../../org/apache/lucene/search/grouping/AbstractDistinctValuesCollector.GroupCount.html" title="class in org.apache.lucene.search.grouping">AbstractDistinctValuesCollector.GroupCount</a>&lt;GROUP_VALUE_TYPE&gt;</td>
<td class="colLast">
<div class="block">Returned by <a href="../../../../../org/apache/lucene/search/grouping/AbstractDistinctValuesCollector.html#getGroups--"><code>AbstractDistinctValuesCollector.getGroups()</code></a>,
 representing the value and set of distinct values for the group.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../../../org/apache/lucene/search/grouping/AbstractFirstPassGroupingCollector.html" title="class in org.apache.lucene.search.grouping">AbstractFirstPassGroupingCollector</a>&lt;GROUP_VALUE_TYPE&gt;</td>
<td class="colLast">
<div class="block">FirstPassGroupingCollector is the first of two passes necessary
  to collect grouped hits.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../../../org/apache/lucene/search/grouping/AbstractGroupFacetCollector.html" title="class in org.apache.lucene.search.grouping">AbstractGroupFacetCollector</a></td>
<td class="colLast">
<div class="block">Base class for computing grouped facets.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../../../org/apache/lucene/search/grouping/AbstractGroupFacetCollector.FacetEntry.html" title="class in org.apache.lucene.search.grouping">AbstractGroupFacetCollector.FacetEntry</a></td>
<td class="colLast">
<div class="block">Represents a facet entry with a value and a count.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../../../org/apache/lucene/search/grouping/AbstractGroupFacetCollector.GroupedFacetResult.html" title="class in org.apache.lucene.search.grouping">AbstractGroupFacetCollector.GroupedFacetResult</a></td>
<td class="colLast">
<div class="block">The grouped facet result.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../../../org/apache/lucene/search/grouping/AbstractGroupFacetCollector.SegmentResult.html" title="class in org.apache.lucene.search.grouping">AbstractGroupFacetCollector.SegmentResult</a></td>
<td class="colLast">
<div class="block">Contains the local grouped segment counts for a particular segment.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../../../org/apache/lucene/search/grouping/AbstractSecondPassGroupingCollector.html" title="class in org.apache.lucene.search.grouping">AbstractSecondPassGroupingCollector</a>&lt;GROUP_VALUE_TYPE&gt;</td>
<td class="colLast">
<div class="block">SecondPassGroupingCollector is the second of two passes
 necessary to collect grouped docs.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../../../org/apache/lucene/search/grouping/BlockGroupingCollector.html" title="class in org.apache.lucene.search.grouping">BlockGroupingCollector</a></td>
<td class="colLast">
<div class="block">BlockGroupingCollector performs grouping with a
  single pass collector, as long as you are grouping by a
  doc block field, ie all documents sharing a given group
  value were indexed as a doc block using the atomic
  <a href="../../../../../../core/org/apache/lucene/index/IndexWriter.html?is-external=true#addDocuments-java.lang.Iterable-" title="class or interface in org.apache.lucene.index"><code>IndexWriter.addDocuments()</code></a> 
  or <a href="../../../../../../core/org/apache/lucene/index/IndexWriter.html?is-external=true#updateDocuments-org.apache.lucene.index.Term-java.lang.Iterable-" title="class or interface in org.apache.lucene.index"><code>IndexWriter.updateDocuments()</code></a> 
  API.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../../../org/apache/lucene/search/grouping/CollectedSearchGroup.html" title="class in org.apache.lucene.search.grouping">CollectedSearchGroup</a>&lt;T&gt;</td>
<td class="colLast">
<div class="block">Expert: representation of a group in <a href="../../../../../org/apache/lucene/search/grouping/AbstractFirstPassGroupingCollector.html" title="class in org.apache.lucene.search.grouping"><code>AbstractFirstPassGroupingCollector</code></a>,
 tracking the top doc and <a href="../../../../../../core/org/apache/lucene/search/FieldComparator.html?is-external=true" title="class or interface in org.apache.lucene.search"><code>FieldComparator</code></a> slot.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../../../org/apache/lucene/search/grouping/GroupDocs.html" title="class in org.apache.lucene.search.grouping">GroupDocs</a>&lt;GROUP_VALUE_TYPE&gt;</td>
<td class="colLast">
<div class="block">Represents one group in the results.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../../../org/apache/lucene/search/grouping/GroupingSearch.html" title="class in org.apache.lucene.search.grouping">GroupingSearch</a></td>
<td class="colLast">
<div class="block">Convenience class to perform grouping in a non distributed environment.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../../../org/apache/lucene/search/grouping/SearchGroup.html" title="class in org.apache.lucene.search.grouping">SearchGroup</a>&lt;GROUP_VALUE_TYPE&gt;</td>
<td class="colLast">
<div class="block">Represents a group that is found during the first pass search.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../../../org/apache/lucene/search/grouping/TopGroups.html" title="class in org.apache.lucene.search.grouping">TopGroups</a>&lt;GROUP_VALUE_TYPE&gt;</td>
<td class="colLast">
<div class="block">Represents result returned by a grouping search.</div>
</td>
</tr>
</tbody>
</table>
</li>
<li class="blockList">
<table class="typeSummary" border="0" cellpadding="3" cellspacing="0" summary="Enum Summary table, listing enums, and an explanation">
<caption><span>Enum Summary</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Enum</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tbody>
<tr class="altColor">
<td class="colFirst"><a href="../../../../../org/apache/lucene/search/grouping/TopGroups.ScoreMergeMode.html" title="enum in org.apache.lucene.search.grouping">TopGroups.ScoreMergeMode</a></td>
<td class="colLast">
<div class="block">How the GroupDocs score (if any) should be merged.</div>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
<a name="package.description">
<!--   -->
</a>
<h2 title="Package org.apache.lucene.search.grouping Description">Package org.apache.lucene.search.grouping Description</h2>
<div class="block">Grouping.
 <p>
 This module enables search result grouping with Lucene, where hits
 with the same value in the specified single-valued group field are
 grouped together.  For example, if you group by the <code>author</code>
 field, then all documents with the same value in the <code>author</code>
 field fall into a single group.
 </p>
 
 <p>Grouping requires a number of inputs:</p>
 
 <ul>
   <li><code>groupField</code>: this is the field used for grouping.
       For example, if you use the <code>author</code> field then each
       group has all books by the same author.  Documents that don't
       have this field are grouped under a single group with
       a <code>null</code> group value.
 
   <li><code>groupSort</code>: how the groups are sorted.  For sorting
       purposes, each group is "represented" by the highest-sorted
       document according to the <code>groupSort</code> within it.  For
       example, if you specify "price" (ascending) then the first group
       is the one with the lowest price book within it.  Or if you
       specify relevance group sort, then the first group is the one
       containing the highest scoring book.
 
   <li><code>topNGroups</code>: how many top groups to keep.  For
       example, 10 means the top 10 groups are computed.
 
   <li><code>groupOffset</code>: which "slice" of top groups you want to
       retrieve.  For example, 3 means you'll get 7 groups back
       (assuming <code>topNGroups</code> is 10).  This is useful for
       paging, where you might show 5 groups per page.
 
   <li><code>withinGroupSort</code>: how the documents within each group
       are sorted.  This can be different from the group sort.
 
   <li><code>maxDocsPerGroup</code>: how many top documents within each
       group to keep.
 
   <li><code>withinGroupOffset</code>: which "slice" of top
       documents you want to retrieve from each group.
 
 </ul>
 
 <p>The implementation is two-pass: the first pass (<a href="../../../../../org/apache/lucene/search/grouping/term/TermFirstPassGroupingCollector.html" title="class in org.apache.lucene.search.grouping.term"><code>TermFirstPassGroupingCollector</code></a>)
   gathers the top groups, and the second pass (<a href="../../../../../org/apache/lucene/search/grouping/term/TermSecondPassGroupingCollector.html" title="class in org.apache.lucene.search.grouping.term"><code>TermSecondPassGroupingCollector</code></a>)
   gathers documents within those groups.  If the search is costly to
   run you may want to use the <a href="../../../../../../core/org/apache/lucene/search/CachingCollector.html?is-external=true" title="class or interface in org.apache.lucene.search"><code>CachingCollector</code></a> class, which
   caches hits and can (quickly) replay them for the second pass.  This
   way you only run the query once, but you pay a RAM cost to (briefly)
   hold all hits.  Results are returned as a <a href="../../../../../org/apache/lucene/search/grouping/TopGroups.html" title="class in org.apache.lucene.search.grouping"><code>TopGroups</code></a> instance.</p>
 
 <p>
   This module abstracts away what defines group and how it is collected. All grouping collectors
   are abstract and have currently term based implementations. One can implement
   collectors that for example group on multiple fields.
 </p>
 
 <p>Known limitations:</p>
 <ul>
   <li> For the two-pass grouping search, the group field must be a
     indexed as a <a href="../../../../../../core/org/apache/lucene/document/SortedDocValuesField.html?is-external=true" title="class or interface in org.apache.lucene.document"><code>SortedDocValuesField</code></a>).
   <li> Although Solr support grouping by function and this module has abstraction of what a group is, there are currently only
     implementations for grouping based on terms.
   <li> Sharding is not directly supported, though is not too
     difficult, if you can merge the top groups and top documents per
     group yourself.
 </ul>
 
 <p>Typical usage for the generic two-pass grouping search looks like this using the grouping convenience utility
   (optionally using caching for the second pass search):</p>
 
 <pre class="prettyprint">
   GroupingSearch groupingSearch = new GroupingSearch("author");
   groupingSearch.setGroupSort(groupSort);
   groupingSearch.setFillSortFields(fillFields);
 
   if (useCache) {
     // Sets cache in MB
     groupingSearch.setCachingInMB(4.0, true);
   }
 
   if (requiredTotalGroupCount) {
     groupingSearch.setAllGroups(true);
   }
 
   TermQuery query = new TermQuery(new Term("content", searchTerm));
   TopGroups&lt;BytesRef&gt; result = groupingSearch.search(indexSearcher, query, groupOffset, groupLimit);
 
   // Render groupsResult...
   if (requiredTotalGroupCount) {
     int totalGroupCount = result.totalGroupCount;
   }
 </pre>
 
 <p>To use the single-pass <code>BlockGroupingCollector</code>,
    first, at indexing time, you must ensure all docs in each group
    are added as a block, and you have some way to find the last
    document of each group.  One simple way to do this is to add a
    marker binary field:</p>
 
 <pre class="prettyprint">
   // Create Documents from your source:
   List&lt;Document&gt; oneGroup = ...;
   
   Field groupEndField = new Field("groupEnd", "x", Field.Store.NO, Field.Index.NOT_ANALYZED);
   groupEndField.setIndexOptions(IndexOptions.DOCS_ONLY);
   groupEndField.setOmitNorms(true);
   oneGroup.get(oneGroup.size()-1).add(groupEndField);
 
   // You can also use writer.updateDocuments(); just be sure you
   // replace an entire previous doc block with this new one.  For
   // example, each group could have a "groupID" field, with the same
   // value for all docs in this group:
   writer.addDocuments(oneGroup);
 </pre>
 
 Then, at search time, do this up front:
 
 <pre class="prettyprint">
   // Set this once in your app &amp; save away for reusing across all queries:
   Filter groupEndDocs = new CachingWrapperFilter(new QueryWrapperFilter(new TermQuery(new Term("groupEnd", "x"))));
 </pre>
 
 Finally, do this per search:
 
 <pre class="prettyprint">
   // Per search:
   BlockGroupingCollector c = new BlockGroupingCollector(groupSort, groupOffset+topNGroups, needsScores, groupEndDocs);
   s.search(new TermQuery(new Term("content", searchTerm)), c);
   TopGroups groupsResult = c.getTopGroups(withinGroupSort, groupOffset, docOffset, docOffset+docsPerGroup, fillFields);
 
   // Render groupsResult...
 </pre>
 
 Or alternatively use the <code>GroupingSearch</code> convenience utility:
 
 <pre class="prettyprint">
   // Per search:
   GroupingSearch groupingSearch = new GroupingSearch(groupEndDocs);
   groupingSearch.setGroupSort(groupSort);
   groupingSearch.setIncludeScores(needsScores);
   TermQuery query = new TermQuery(new Term("content", searchTerm));
   TopGroups groupsResult = groupingSearch.search(indexSearcher, query, groupOffset, groupLimit);

   // Render groupsResult...
 </pre>
 
 Note that the <code>groupValue</code> of each <code>GroupDocs</code>
 will be <code>null</code>, so if you need to present this value you'll
 have to separately retrieve it (for example using stored
 fields, <code>FieldCache</code>, etc.).
 
 <p>Another collector is the <code>TermAllGroupHeadsCollector</code> that can be used to retrieve all most relevant
    documents per group. Also known as group heads. This can be useful in situations when one wants to compute group
    based facets / statistics on the complete query result. The collector can be executed during the first or second
    phase. This collector can also be used with the <code>GroupingSearch</code> convenience utility, but when if one only
    wants to compute the most relevant documents per group it is better to just use the collector as done here below.</p>
 
 <pre class="prettyprint">
   AbstractAllGroupHeadsCollector c = TermAllGroupHeadsCollector.create(groupField, sortWithinGroup);
   s.search(new TermQuery(new Term("content", searchTerm)), c);
   // Return all group heads as int array
   int[] groupHeadsArray = c.retrieveGroupHeads()
   // Return all group heads as FixedBitSet.
   int maxDoc = s.maxDoc();
   FixedBitSet groupHeadsBitSet = c.retrieveGroupHeads(maxDoc)
 </pre>
 
 <p>For each of the above collector types there is also a variant that works with <code>ValueSource</code> instead of
    of fields. Concretely this means that these variants can work with functions. These variants are slower than
    there term based counter parts. These implementations are located in the
    <code>org.apache.lucene.search.grouping.function</code> package, but can also be used with the
   <code>GroupingSearch</code> convenience utility
 </p></div>
</div>
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../overview-summary.html">Overview</a></li>
<li class="navBarCell1Rev">Package</li>
<li>Class</li>
<li><a href="package-use.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li>Prev&nbsp;Package</li>
<li><a href="../../../../../org/apache/lucene/search/grouping/function/package-summary.html">Next&nbsp;Package</a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../index.html?org/apache/lucene/search/grouping/package-summary.html" target="_top">Frames</a></li>
<li><a href="package-summary.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy"><small>
          <i>Copyright &copy; 2000-2016 Apache Software Foundation.  All Rights Reserved.</i>
          <script src='../../../../../prettify.js' type='text/javascript'></script>
          <script type='text/javascript'>
            (function(){
              var oldonload = window.onload;
              if (typeof oldonload != 'function') {
                window.onload = prettyPrint;
              } else {
                window.onload = function() {
                  oldonload();
                  prettyPrint();
                }
              }
            })();
          </script>
        </small></p>
</body>
</html>
